/*****************公共js function start***********/
//地址栏有无字符串 判断页面  elems 是否含有值
function url_has(elems){
    if(window.location.href.indexOf(elems)!=-1){
        return true;
    }
    else{
        return false;
    }
}
//查看图片
$('.z2u .modalbox_img').click(function(e){
    $(this).css('display','none');
});
function modalbox_img(src){
    $('.z2u .modalbox_img').css('display','flex');
    $('.z2u .modalbox_img img').attr('src',src);
}
function send_Verification_code(urlb,elem,data = '') {
    $.ajax({
        type: 'get',
        url: urlb,
        data:data,
        dataType: 'json',
        success: (res)=> {
            if(res.code == 0) {
                let html = '';
                html += ` <div class="baocuodiv margin_10 text-center">
                           	   <span class="text-danger">${res.msg}</span> 
                           </div>`;
                if(elem.parents('.yzm_form').find('.baocuodiv')) {
                    elem.parents('.yzm_form').find('.baocuodiv').remove();
                }
                elem.parents('.yzm_form').find('.yzm').parent().append(html);
            } else {
                let html = '';
                html += `<div class="baocuodiv margin_10">
                           	   <span class="text-success">${res.msg}</span> 
                           </div>`;
                if(elem.parents('.yzm_form').find('.baocuodiv')) {
                    elem.parents('.yzm_form').find('.baocuodiv').remove();
                }
                elem.parents('.yzm_form').find('.yzm').parent().append(html);
            }
        },
        error:(res)=>{
            let html = '';
            html += `<div class="baocuodiv margin_10 text-center">
                           	   <span class="text-danger">error</span> 
                           </div>`;
            if(elem.parents('.yzm_form').find('.baocuodiv')) {
                elem.parents('.yzm_form').find('.baocuodiv').remove();
            }
            elem.parents('.yzm_form').find('.yzm').parent().append(html);

        }
    });
    elem.attr('disabled','disabled');
    var n = 30;
    if(urlb.indexOf('zh-CN/')>-1){
        elem.text('重新发送30s后');
    }else{
        elem.text('30s after retransmission');
    }
    var ttime = setInterval(() => {
        n--;
        if(urlb.indexOf('zh-CN/')>-1){
            elem.text('重新发送' + n + 's后');
        }else{
            elem.text(n + 's after retransmission');
        }
        if(n <= 0) {
            if(urlb.indexOf('zh-CN/')>-1){
                elem.text('获取验证码');
            }else{
                elem.text('Get Token');
            }
            clearInterval(ttime);
            elem.prop('disabled','');
        }
    }, 1000);
}
//url 添加建值1次
function add_get_url(url,keyword,text){
    //破解url first ?前   last ?及后  缺点只能跳一次，第二次会重复
    //keyword 建  text 值
    let urlany='';
    let urllast='';
    let urlfirst='';
    if(url.indexOf('?')!=-1){
        urllast=url.slice(url.indexOf('?'),url.length);
        urlfirst=url.slice(0,url.indexOf('?'));
        urlany=urlfirst+urllast+'&'+keyword+'='+text;
        return urlany;

    }
    else{
        urlany=url+'?'+keyword+'='+text;
        return urlany;
    }

}
//url 添加建值可多次
//地址栏传值添加 有无的判断 ？& url 地址  server 申明的变量 默认“” 变量字符串 ？&xx=id   str 建  id 值
function urlpanduan(url,server,str,id){
    if(url.indexOf('?')!=-1){
        let index1=url.indexOf('?');
        let surl=url;
        //揭破出来
        let zhifu=surl.substring(index1+1,surl.length);
        //没有 拼接值的
        let wupinjie=surl.substring(0,index1);
        //	判断有没&
        if(zhifu.indexOf('&')!=-1){
            //如有& 拼成数组
            var shuzu=[];
            let arr=zhifu.split('&');
            for(var i=0;i<arr.length;i++){
                if(arr[i].indexOf(str)==-1){
                    //等于-1 就是没有
                    //如果没得tree_id 就添加
                    if (str=='server'){
                        if (arr[i].indexOf('tree_id')==-1){
                            shuzu[shuzu.length]=arr[i];
                        }
                    }else{
                        shuzu[shuzu.length]=arr[i];
                    }
                }
            }
            let zzurl = '';
            if (shuzu.length>0){
                zzurl = shuzu.join('&');
            }
            server= id ? '?'+str+'='+escape(id) : '';
            zzurl = (server ? '&' : '?')+zzurl;
            window.location.href=wupinjie+server+zzurl;
        }
        else{
            //如果没得&的就是单？
            var shuzuzi='';
            if(zhifu.indexOf(str)==-1){
                //如果没得server 就添加
                shuzuzi=zhifu;
            }
            server= id ? '?'+str+'='+escape(id) : '';
            window.location.href=wupinjie+server;
            if(shuzuzi==''||shuzuzi==undefined){
                //如果没得数据
                window.location.href=wupinjie+server;
            }else{
                shuzuzi = (server ? '&' : '?') + shuzuzi;
                window.location.href=wupinjie+server+shuzuzi;
            }

        }
    }else{
        server= id ? '?'+str+'='+escape(id) : '';
        window.location.href=url+server;
    }
    // if(id.indexOf('#')!=-1){
    //     location.reload()
    // }
}
function processActiona(id,action,msg){
    $('.motaikuang').css('display', 'block');
    $('.motaikuang').find('.wenben').text(msg);
    //确认
    $('#login_guanli .motaikuang .queren').click(function() {

        let data = {};

        data = {
            list_pk: id,
            list_action:action
        }

        $.ajax({
            type: 'post',
            url: "{:url('/platform/sell/productAction')}",
            dataType: 'json',
            data: data,
            success: (res)=> {

                if(res.code == 0) {

                } else {

                    location.reload();

                }
            },
            error: ()=> {

            }
        });

    });
}
//默认点击空白关闭 传建，就不删除当前建，默认不传，删除所有建，及影藏所有
function close_all(elem){

    // 设置目标区域
    var arr=
        {
            login_after:'.z2u .home .home_header .language_currency .libox.login_after .denglutankuang',
            subset:'.z2u .home .home_nav .navbox .navleft .navulbox .subset',
            searchbox_new:'.z2u .home .home_header_bottom .header_bottom_box .searchbox .searchbox_new',
            comment_content:'.home_header .language_currency .message_notice .comment_content',
            menubox:'.chat_record .chat_left .menubox'
        };
    delete arr[elem];

    for(var a in arr){
        $(arr[a]).addClass('hidden');

    }
}
//指定打开元素  传 指定$();
function open_sign(elem){
    elem.removeClass('hidden');
}
//bootstrap 悬停title  tooltip 缺点不能点击  上下左右
$("[data-toggle='tooltip']").tooltip();
//点击打开  上下左右   可以加悬停效果
$("[data-toggle='popover']").popover();
//判断是否为空   elem 不能为空
function panture(elem){
    if(elem!=''&&elem!=undefined&&elem!=null){
        return true;
    }
    else{
        return false;
    }
}

//ajax方法
function ajaxmothed(data,method,url,type,jump){
    if(type=2){
        $('.motaikuang').css('display','block');
    }
    $.ajax({
        type: method,
        url: url,
        dataType: 'json',
        data: data,
        success: function (res) {
            if (res.code == 0) {


            } else {

                if(type==1){
                    if(jump){
                        window.location.href=res.jump;
                    }
                    else{
                        if(res.url)
                            window.location.href=res.url;
                    }

                }
                else if(type==3){
                    window.location.reload();
                }

                return res;
            }
        },
        error:  ()=> {

        }
    })
}

//ajax方法2
function ajaxmothed2(data,method,url,type,modal,jump){
    if(type=2){
        $(modal).css('display','block');
    }
    $.ajax({
        type: method,
        url: url,
        dataType: 'json',
        data: data,
        success: function (res) {
            if (res.code == 0) {


            } else {

                if(type==1){
                    if(jump){
                        window.location.href=res.jump;
                    }
                    else{
                        if(res.url)
                            window.location.href=res.url;
                    }

                }

                return res;
            }
        },
        error: function () {

        }
    })
}
//弹框关闭按钮的动画，关闭事件
$('.motaikuang .closemo').click(function(e) {
    $(this).parents('.motaikuang').css('display','none');
}).mouseenter(function() {
    $(this).addClass('transform');
}).mouseleave(function() {
    $(this).removeClass('transform');
});
//默认点击弹框阴影部分关闭弹框
$('.motaikuang').click(function(e) {
    $(this).css('display','none');
});
//默认不关闭
$('.motaikuangbody').click(function(e) {
    e.stopPropagation();
});
//打开指定模态框 motaikuang('.xxx');
function motaikuang(elem){
    return $(elem).css('display','block');
}
//js创建确认信息弹框  title 弹框头部标题  text确认信息 elem=>buttonok需要调用的方法  btn1,2,中英需要按钮的文本
function motaikuangjsconfirm(title,text,elem,button1,button2){
    let motaikuangjs=$('<div class="motaikuangjs"></div>');
    let motaikuangbody=$('<div class="motaikuangbody"></div>');
    let header=`<div class="header">${title}<a class='closemo'>&times;</a></div>`;
    let main=$('<div class="main"></div>');
    let wenben=`<div class="wenben">${text}</div>`;
    let buttonbox=$('<div class="buttonbox flex_between"></div>');
    let buttoncancel=$('<button class="closemo"></button>').text(button1);
    let buttonok=$('<button type="submit" class="buttonok"></button>').text(button2);
    $('body').append(motaikuangjs);
    motaikuangjs.append(motaikuangbody);
    motaikuangbody.append(header);
    motaikuangbody.append(main);
    main.append(wenben);
    main.append(buttonbox);
    buttonbox.append(buttoncancel);
    buttonbox.append(buttonok);
    $('.motaikuangjs').css('display', 'block');
    $('.motaikuangjs .buttonok').click(function(e){
        $(this).parents('.motaikuangjs').remove();
        $(elem).click();

    });
    $('.motaikuangjs .closemo').click(function(e) {
        $(this).parents('.motaikuangjs').remove();
    }).mouseenter(function() {
        $(this).addClass('transform');
    }).mouseleave(function() {
        $(this).removeClass('transform');
    });
    $('.motaikuangjs').click(function(e) {
        $(this).remove();
    });
    //默认不关闭
    $('.motaikuangbody').click(function(e) {
        e.stopPropagation();
    });
}
//js创建确认信息弹框 带提交接口方式
function motaikuangjs2(title,text,data,method,url,elem){
    let motaikuangjs=$('<div class="motaikuangjs"></div>');
    let motaikuangbody=$('<div class="motaikuangbody"></div>');
    let header=`<div class="header">${title}<a class='closemo'>&times;</a></div>`;
    let main=$('<div class="main"></div>');
    let wenben=`<div class="wenben">${text}</div>`;
    let buttonbox=$('<div class="buttonbox flex_between"></div>');
    let buttoncancel=$('<button class="closemo"></button>').text('取消');
    let buttonok=$('<button class="buttonok"></button>').text('确定');
    $('body').append(motaikuangjs);
    motaikuangjs.append(motaikuangbody);
    motaikuangbody.append(header);
    motaikuangbody.append(main);
    main.append(wenben);
    main.append(buttonbox);
    buttonbox.append(buttoncancel);
    buttonbox.append(buttonok);
    $('.motaikuangjs').css('display', 'block');
    //模态框
    document.onkeydown = function (e) { // 回车提交表单
        var code = e.keyCode;
        if($('.motaikuangjs').length>0){
            if (code == 13) {
                $('.motaikuangjs .buttonok').click();
            }
        }
    }
    $('.motaikuangjs .buttonok').click(function(e){
        $.ajax({
            type: method,
            url: url,
            dataType: 'json',
            data: data,
            success:  (res)=> {
                if (res.code == 0) {
                } else {
                    elem.remove();
                    $(this).parents('.motaikuangjs').remove();
                }
            },
            error: function () {

            }
        })
    });
    $('.motaikuangjs .closemo').click(function(e) {
        $(this).parents('.motaikuangjs').remove();
    }).mouseenter(function() {
        $(this).addClass('transform');
    }).mouseleave(function() {
        $(this).removeClass('transform');
    });
    $('.motaikuangjs').click(function(e) {
        $(this).remove();
    });
    //默认不关闭
    $('.motaikuangbody').click(function(e) {
        e.stopPropagation();
    });
}
//js创建确认信息弹框 带提交接口方式   url判断有无跳转
function motaikuangjs(title,text,data,method,url,type,jump){
    let motaikuangjs=$('<div class="motaikuangjs"></div>');
    let motaikuangbody=$('<div class="motaikuangbody"></div>');
    let header=`<div class="header">${title}<a class='closemo'>&times;</a></div>`;
    let main=$('<div class="main"></div>');
    let wenben=`<div class="wenben">${text}</div>`;
    let buttonbox=$('<div class="buttonbox flex_between"></div>');
    let buttoncancel=$('<button class="closemo"></button>').text('取消');
    let buttonok=$('<button class="buttonok"></button>').text('确定');
    $('body').append(motaikuangjs);
    motaikuangjs.append(motaikuangbody);
    motaikuangbody.append(header);
    motaikuangbody.append(main);
    main.append(wenben);
    main.append(buttonbox);
    buttonbox.append(buttoncancel);
    buttonbox.append(buttonok);
    $('.motaikuangjs').css('display', 'block');
    //模态框
    $('.motaikuangjs .buttonok').click(function(e){
        $.ajax({
            type: method,
            url: url,
            dataType: 'json',
            data: data,
            success: function (res) {
                if (res.code == 0) {
                } else {
                    $('.motaikuangjs').remove();
                    if(type==1){
                        if(jump){
                            window.location.href=res.jump;
                        }
                        else{
                            if(res.url)
                                window.location.href=res.url;
                        }

                    }

                }
            },
            error: function () {

            }
        })
    });
    $('.motaikuangjs .closemo').click(function(e) {
        $(this).parents('.motaikuangjs').remove();
    }).mouseenter(function() {
        $(this).addClass('transform');
    }).mouseleave(function() {
        $(this).removeClass('transform');
    });
    $('.motaikuangjs').click(function(e) {
        $(this).remove();
    });
    //默认不关闭
    $('.motaikuangbody').click(function(e) {
        e.stopPropagation();
    });
}
// 数量斧正
function fixnumIfmultiple(id){
    var input = $('#buy_num_'+id);
    let minval = parseInt(input.attr('data'));
    let maxval = parseInt(input.parents('.timebox').find('.gold').data('num'));
    let multiple = parseInt(input.attr('data-multiple'));
    let numval = parseInt(input.val());
    let danjia = parseFloat(input.parents('.timebox').parent().find('.danjia').eq(0).text()).toFixed(8);
    let currtext = input.attr('data-currency');
    if (multiple!='0'){
        var numpart = (numval%minval)/minval;
        if(numpart!='0' || !numval){
            numval = (numpart>=0.5 && numval!=maxval) ? (numval - numval%minval + minval) : (numval - numval%minval);
            numval = numval>0 ? numval : minval;
            input.val(numval);
            input.next().removeClass('hidden');
            input.next().text('The number entered must be a multiple of '+minval);
            if(url_has('/zh-CN')){
                input.next().text('输入的数字必须是'+minval+'的倍数');
            }
            input.addClass('borderred');
            input.parents('.timebox').next().find('.price').text(accMul(numval, danjia).toFixed(2)+' '+currtext);
            if ($('.pre-coupon-price').length > 0) {
                old_danjia = parseFloat($('.pre-coupon-price').data('price'));
                input.parents('.timebox').next().find('.oldprice').text(accMul(numval, old_danjia).toFixed(2));
            }
            //setTimeout("hiddenError("+id+")", 5000);
        }
    }
}

$(document).on('change', '.select_change_num', function() {
    var input = $(this);
    let minval = parseInt(input.attr('data'));
    let maxval = parseInt(input.parents('.timebox').find('.gold').data('num'));
    let numval = parseInt(input.val());
    let danjia = parseFloat(input.parents('.timebox').parent().find('.danjia').eq(0).text()).toFixed(8);
    let currtext = input.attr('data-currency');
    numval = numval > minval ? numval : minval; // 不能小于最小值
    numval = numval > maxval ? maxval : numval; // 不能大于最大值
    input.parents('.timebox').next().find('.price').text(accMul(numval, danjia).toFixed(2)+' '+currtext);
    if ($('.pre-coupon-price').length > 0) {
        old_danjia = parseFloat($('.pre-coupon-price').data('price'));
        input.parents('.timebox').next().find('.oldprice').text(accMul(numval, old_danjia).toFixed(2));
    }
    let buy_button = input.parents('.timebox').next('div').find('.show-cart-icon');
    let data_href = buy_button.data('href');
    let url_ext = input.hasClass('shop') ? '&from=shop' : '';
    if (data_href.indexOf('?') > -1) {
        buy_url = data_href+'&buy_num='+numval;
    } else {
        buy_url = data_href+'?buy_num='+numval;
    }
    buy_button.attr('href', buy_url + url_ext);
})

// Ajax获取单价、判断输入数量是否正确
function ajaxFixNum(id, num) {
    var input = $('#buy_num_'+id);
    let minval = parseInt(input.attr('data'));
    var numVal = num || parseInt(input.val());
    var langPre = $('input[name="lang-prefix"]').val();
    $.get(langPre+"/getGoldUnitPrice", {'product_id': id, 'buy_num': numVal}, function(data) {
        if (data.code == 1) {
            input.parents('.timebox').parent().find('.danjia').eq(0).text(data.data.final_price);
            $('.price-block .b-text').text(data.data.final_price);
            input.parents('.timebox').next().find('.price').text(Math.round(accMul(numVal, data.data.final_price)*100)/100);
            if ($('.pre-coupon-price').length > 0) {
                input.parents('.timebox').next().find('.oldprice').text(Math.round(accMul(numVal, data.data.final_price_old)*100)/100);
            }
            input.val(data.data.buy_num);

            // 提示
            if (numVal != data.data.buy_num) {
                input.next().removeClass('hidden');
                input.addClass('borderred');
                input.next().text('The number entered must be a multiple of '+minval);
                if(url_has('/zh-CN')){
                    input.next().text('输入的数字必须是'+minval+'的倍数');
                }
            }
        } else {
            input.val(input.attr('data'));
        }
    });

}

function hiddenError(id){
    $('#buy_num_'+id).next().addClass('hidden');
}

function getGoldUnitPrice(id, type)
{
    var input = $('#buy_num_'+id);
    var multiple = input.attr('data-multiple');
    var numval = parseInt(input.val());
    var minval = parseInt(input.attr('data'));
    var num = 0;
    var langPre = $('input[name="lang-prefix"]').val();
    if (type == 'add'){
        num = (multiple != '0') ? (numval + minval) : (numval + 1);
    }else{
        num = (multiple != '0') ? (numval - minval) : (numval - 1);
    }
    $.get(langPre+"/getGoldUnitPrice", {'product_id': id, 'buy_num': num}, function(data) {
        if (data.code == 1) {
            input.parents('.timebox').parent().find('.danjia').eq(0).text(data.data.final_price);
            $('.price-block > .pull-right > .b-text').text(data.data.final_price);
            $('.pre-coupon-price').data('price', data.data.final_price_old);
        }
        buynumChange(id, type);
    });
}
// 按钮点击数量加减
function buynumChange(id,type, changeNum = 0){
    var input = $('#buy_num_'+id);
    var multiple = input.attr('data-multiple');
    var numval = parseInt(input.val());
    var minval = parseInt(input.attr('data'));
    var maxnum = parseInt(input.attr('max'));
    if (type == 'add'){
        num = (multiple != '0') ? (numval + minval) : (numval + 1);
    }else{
        num = (multiple != '0') ? (numval - minval) : (numval - 1);
    }
    if(num >= maxnum){
        if (multiple!='0'){
            var numpart = (maxnum%minval)/minval;
            num = (numpart>=0.5 && maxnum!=num) ? (maxnum - maxnum%minval + minval) : (maxnum - maxnum%minval);
        }else{
            num = maxnum;
        }
    }else if (num <= minval){
        num = minval
    }
    if (changeNum != 0) {
        alert();
        num = changeNum;
    }
    input.val(num);
    let buy_button = input.parents('.timebox').next('div').find('.show-cart-icon');
    if (buy_button.data('href')!= undefined && buy_button.data('href').indexOf('?') > -1) {
        buy_url = buy_button.data('href')+'&buy_num='+num;
    } else {
        buy_url = buy_button.data('href')+'?buy_num='+num;
    }
    buy_button.attr('href',buy_url);

    let maxval = parseInt(input.parents('.timebox').find('.gold').data('num'));
    let danjia = parseFloat(input.parents('.timebox').parent().find('.danjia').eq(0).text()).toFixed(8);
    let currtext = input.attr('data-currency');

    // 四舍五入， toFixed在遇到类似这种 6.055 会得到6.05
    let totalPrice = Math.round(accMul(input.val(), danjia)*100)/100;
    input.parents('.timebox').next().find('.price').text(totalPrice+' '+currtext);
    if ($('.pre-coupon-price').length > 0) {
        old_danjia = parseFloat($('.pre-coupon-price').data('price'));
        input.parents('.timebox').next().find('.oldprice').text(Math.round(accMul(input.val(), old_danjia)*100)/100);
    }
    if(input.val() == '' || input.val == undefined) {
        input.next().removeClass('hidden');
        input.next().text('Invalid input');
        if(url_has('/zh-CN')){
            input.next().text('无效的输入');
        }
        input.addClass('borderred');
        input.parents('.timebox').next().find('.price').text('0.00');
    } else {
        if(input.val() > maxval) {
            input.next().removeClass('hidden');
            input.next().text('Maximum purchase is ' + maxval);
            if(url_has('/zh-CN')){
                input.next().text('最大购买 ' + maxval);
            }
            input.addClass('borderred');
            input.parents('.timebox').next().find('.price').text('0.00');
        } else if(input.val() < minval) {
            input.next().removeClass('hidden');
            input.next().text('Minimum purchase is ' + minval);
            if(url_has('/zh-CN')){
                input.next().text('最低购买 ' + minval);
            }
            input.addClass('borderred');
            input.parents('.timebox').next().find('.price').text('0.00');
        } else {
            input.next().addClass('hidden');

            input.removeClass('borderred');
        }
    }
}

/**
 * 结算页面，获取金币单价
 * @param id
 * @param type
 */
function getGoldUnitPrice2(id, type = '')
{
    var input = $('#number_input');
    var multiple = input.attr('data-multiple');
    var numval = parseInt(input.val());
    var minval = parseInt(input.attr('min'));
    var num;
    var langPre = $('input[name="lang-prefix"]').val();
    if (type) {
        if (type == 'add'){
            num = (multiple != '0') ? (numval + minval) : (numval + 1);
        }else{
            num = (multiple != '0') ? (numval - minval) : (numval - 1);
        }
    } else {
        num = numval;
    }
    $.get(langPre+"/getGoldUnitPrice", {'product_id': id, 'buy_num': num}, function(data) {
        if (data.code == 1) {
            input.attr('data', data.data.final_price)
        }
        buynumChange2(id,type);
    });
}

function buynumChange2(id,type){
    var input = $('#number_input');
    var multiple = input.attr('data-multiple');
    var numval = parseInt(input.val());
    var minval = parseInt(input.attr('min'));
    var maxnum = parseInt(input.attr('max'));
    if (type) {
        if (type == 'add'){
            num = (multiple != '0') ? (numval + minval) : (numval + 1);
        }else{
            num = (multiple != '0') ? (numval - minval) : (numval - 1);
        }
    } else {
        num = numval;
    }

    if(num >= maxnum){
        if (multiple!='0'){
            var numpart = (maxnum%minval)/minval;
            num = (numpart>=0.5 && maxnum!=num) ? (maxnum - maxnum%minval + minval) : (maxnum - maxnum%minval);
        }else{
            num = maxnum;
        }
    }else if (num <= minval){
        num = minval
    }
    input.val(num);
    getCoupon(id,num);
    let num1=$(`#product_jiezhang .main   .maincontentright .pricecontent
					.contentheader .libox.liboxdong .liboxright .num`);
    let danjia = parseFloat(input.attr('data')).toFixed(8);
    final_price = Math.round(accMul(num, danjia)*100)/100;;
    num1.text(final_price);
    // CREDIT
    fix_cut_rest_amount(final_price);
}
function fix_cut_rest_amount(final_price){
    var balance_amount = $('#balance_amount').attr('data');
    if (balance_amount) {
        final_price = parseFloat(final_price);
        balance_amount = parseFloat(balance_amount);
        cut_amount = (final_price > balance_amount) ? balance_amount : final_price;
        $('#cut_amount').text(cut_amount);
        rest_amount = balance_amount - final_price;
        rest_amount = (rest_amount >=0) ? rest_amount.toFixed(2) : 0.00;
        $('#rest_amount').text('USD $ '+rest_amount);
    }
}

function fixnumIfmultiple2(id){
    var input = $('#number_input');
    let minval = parseInt(input.attr('min'));
    let maxval = parseInt(input.attr('max'));
    let multiple = parseInt(input.attr('data-multiple'));
    let numval = parseInt(input.val());
    let danjia = parseFloat(input.attr('data')).toFixed(8);
    let num1=$(`#product_jiezhang .main   .maincontentright .pricecontent
					.contentheader .libox.liboxdong .liboxright .num`);
    if (multiple!='0'){
        var numpart = (numval%minval)/minval;
        numval = (numpart>=0.5 && numval!=maxval) ? (numval - numval%minval + minval) : (numval - numval%minval);
        input.val(numval);
        getCoupon(id,numval);
        num1.text(accMul(numval, danjia).toFixed(2));
        fix_cut_rest_amount(accMul(numval, danjia).toFixed(2));
    }
}

function getCoupon(id,num) {
    $.ajax({
        type: 'post',
        url: "getCoupon",
        dataType: 'json',
        data: {product_id:id,num:num},
        success: (res)=> {
            if(res.code == 1) {
                $('#coupon_html').html(res.data);
                $('#discount_amount').html('-');
            } else {

            }
        },
        error: ()=> {

        }
    });
}
//判断是 input select checkbox
function yanzhen(str) {
    //判断是input  form
    if($(str).hasClass('form-control')) {
        if($(str).val() == undefined || $(str).val() == '') {

            $(str).next().removeClass('hidden');
        } else {
            $(str).next().addClass('hidden');
        }
    }
    //判断是div
    else if($(str).hasClass('wenben')) {
        if($(str).text() == undefined || $(str).text() == '' || $(str).text() == '请选择') {

            $(str).parents('.selectallbox').next().removeClass('hidden');
        } else {
            $(str).parents('.selectallbox').next().addClass('hidden');

        }
    }
    //判断选项单选，多选
    else if($(str).hasClass('dan')) {
        if(!$(str).prop('checked')) {

            $(str).parents('.labelbox').next().removeClass('hidden');
        } else {
            $(str).parents('.labelbox').next().addClass('hidden');

        }
    }

}
//js添加下个元素为上个元素的title
function nexthiddenshow(xx) { //title 下个兄弟title

    $('body').on('mouseenter',xx,function() {
        $(this).next('.box').removeClass('hidden');
    });
    $('body').on('mouseleave',xx,function() {
        $(this).next('.box').addClass('hidden');
    });
}
//算法精确值
function accMul(arg1, arg2) {
    var m = 0,
        s1 = arg1.toString(),
        s2 = arg2.toString();
    try {
        m += s1.split(".")[1].length

    } catch(e) {}
    try {
        m += s2.split(".")[1].length
    } catch(e) {}
    return Number(s1.replace(".", "")) * Number(s2.replace(".", "")) / Math.pow(10, m)
}

//给Number类型增加一个mul方法，调用起来更加方便。
Number.prototype.mul = function(arg) {
    return accMul(arg, this);
}

//除法函数，用来得到精确的除法结果
//说明：javascript的除法结果会有误差，在两个浮点数相除的时候会比较明显。这个函数返回较为精确的除法结果。
//调用：accDiv(arg1,arg2)
//返回值：arg1除以arg2的精确结果
//除法
function accDiv(arg1, arg2) {
    var t1 = 0,
        t2 = 0,
        r1, r2;
    try {
        t1 = arg1.toString().split(".")[1].length;
    } catch(e) {}
    try {
        t2 = arg2.toString().split(".")[1].length;
    } catch(e) {}
    with(Math) {
        r1 = Number(arg1.toString().replace(".", ""));
        r2 = Number(arg2.toString().replace(".", ""));
        return(r1 / r2) * pow(10, t2 - t1);
    }
}

//给Number类型增加一个div方法，调用起来更加方便。
Number.prototype.div = function(arg) {
    return accDiv(this, arg);
}

//加法函数，用来得到精确的加法结果
//说明：javascript的加法结果会有误差，在两个浮点数相加的时候会比较明显。这个函数返回较为精确的加法结果。
//调用：accAdd(arg1,arg2)
//返回值：arg1加上arg2的精确结果
//加法
function accAdd(arg1, arg2) {
    var r1, r2, m;
    try {
        r1 = arg1.toString().split(".")[1].length
    } catch(e) {
        r1 = 0
    }
    try {
        r2 = arg2.toString().split(".")[1].length
    } catch(e) {
        r2 = 0
    }
    m = Math.pow(10, Math.max(r1, r2));
    return(arg1 * m + arg2 * m) / m;
}

//给Number类型增加一个add方法，调用起来更加方便。
Number.prototype.add = function(arg) {
    return accAdd(arg, this);
}
//模态框

if($('.am-dimme').length != 0) {
    $('body').on('click', '.am-dimme', function(e) {
        e.stopPropagation();
        e.preventDefault();
        $(this).css('display', 'none');

        $(this).children('.am-modal').click(function(e) {
            e.stopPropagation();
        });
    });
}

//点击修改当前点击的内容

function clickchangename(elem) {
    this.elemname = elem.text();

}
let objone = {
    one: 1,
    two: 2,
    info: function() {
        return this.one + this.two;
    }
}
//消息提示框  (成功 success,错误 error,警告 jingao,信息 message)=>fs  str=>'字段, loaction是否更新，默认更新，0不更新
function infoalert(fs, str,location) { //消息提示框
    $('.infoalert').removeClass('top');


    $('.infoalert .boxwenben').addClass('hidden');


    $('.infoalert .textinfo').html(str);
    if(fs == 'error') {
        $('.infoalert .error').removeClass('hidden');

    } else if(fs == 'success') {
        $('.infoalert .success').removeClass('hidden');
        if(location!=0)
            delay_location();


    } else if(fs == 'jingao') {
        $('.infoalert .jingao').removeClass('hidden');

    } else if(fs == 'message') {
        $('.infoalert .message').removeClass('hidden');

    }
    var s = 0;
    var t = setInterval(function() {
        s++;
        if(s > 5) {
            clearInterval(t);
            $('.infoalert').addClass('top');
        }
    }, 1500)
}
/*****************公共js function end***********/
/**************************冒泡事件 start***********/
$(document).click(function() { //
    //个人弹框点击空白关闭
    maopaoclose();
    maopaoclosexia();
    $('.am-dimme,.problem_header .problem_inputbox .input_content').css('display', 'none');
    $('.selectall .ulbox').addClass('hidden');
    $('.stopmao').click(function(e) {
        e.stopPropagation();
    });
    $('.home_header_bottom .header_bottom_box .classification .menu .menu2').addClass('hidden');
});
//点击空白关闭元素
function close_elem(elem){
    $(document).click(function() {
        return  elem.addClass('hidden');
    });
}
//点击空白关闭元素
function close_elemb(elem){
    return  elem.addClass('hidden');
}
function $id(elem) {
    return document.getElementById(elem);
}
function $query(elem){
    return document.querySelectorAll(elem);
}
function bodyclose() {
    $(document).click(function() {
        //个人弹框点击关闭
        maopaoclose();
        maopaoclosexia();
    });
}
//延迟刷新
function delay_location(){
    setTimeout(()=>{
        window.location.reload();
    },2000);
}

function re_location(elem){
    if(elem==1){
        window.location.reload(true);
    }
    else{
        window.location.reload();
    }

}
function maopaoclose() { //冒泡事件  点击空白关闭
    $('.closebox').addClass('hidden');
    //$('.alltankuang').fadeOut(500);
}

function maopaoclosexia() {
    $('.glyxia').addClass('glyphicon-menu-down');
    $('.glyxia').removeClass('glyphicon-menu-up');
    $('.glyxia').removeClass('transform');
}

function maopaocloseshang(xx) {
    xx.removeClass('glyphicon-menu-down');
    xx.addClass('glyphicon-menu-up');
}
//closeall('#jc_indexheader .denglutankuang');

function maopao(xx) { //冒泡事件
    $(xx).click(function(e) {
        e.stopPropagation();
    });
}
//header 分类游戏
$('.home_header_bottom .fenleibox').click(function(e) { //分类
    e.stopPropagation();
    if(!$('.home_header_bottom .menu').hasClass('hidden')) {
        $('.home_header_bottom .menu').addClass('hidden');
        $('.home_header_bottom .header_bottom_box .classification .menu .menu2').addClass('hidden');
        maopaoclosexia();
    } else {
        maopaoclose();
        maopaoclosexia();
        $('.home_header_bottom .menu').removeClass('hidden');
    }
});
var menu1_name = '';
$('.home_header_bottom .menu1>.libox').hover(function(e) {
    $('.home_header_bottom .menu2').removeClass('hidden');
    var b = $(this).next('.menu3').html();
    $('.home_header_bottom .menu2').html(b);
    var wbTxt = $(this).find('.wenben').text();
    $('.go-fl-back').text(wbTxt);
    $('.go-fl-back').click(function(){ //点击隐藏menu2
        if ($(this).next('div').hasClass('cat-menu-sub')) {
            if ($('.menu2 .cat-menu-sub').length == $('.menu2 .category-menu-sub.hidden').length) {
                $('.menu2').addClass('hidden');
            } else {
                $('.menu2 .category-menu-sub').addClass('hidden');
                $('.go-fl-back').text(menu1_name);
            }
        } else {
            $('.menu2').addClass('hidden');
        }

    });
});

$(document).on('mouseenter', '.showSubMenu', function() {
    var _this = $(this);
    var e = window.event;
    var targ = e.target;
    var tclass = targ.className;
    if (tclass.indexOf('noscript') == -1){
        if($(_this).find('.category-menu-sub').hasClass('hidden')){
            $(_this).find('.category-menu-sub').removeClass('hidden')
            $(_this).siblings().find('.category-menu-sub').addClass('hidden')
        }else {
            $(_this).find('.category-menu-sub').addClass('hidden')
            $(_this).siblings().find('.category-menu-sub').removeClass('hidden')
        }
        menu1_name = $('.go-fl-back').eq(0).text();
        $('.go-fl-back').text($(_this).children('a').find('.wenben').text());
    }
})
/**************************冒泡事件 start***********/
$(function() {
    //表单验证
    /**************************注册登录页start ***********/
//邮箱验证
    $('#register_address,.register_address').blur(function() {
        var email = $(this).val();
        var reg =  /^\w+((.\w+)|(-\w+))(\w{3})@[A-Za-z0-9]+((.|-)[A-Za-z0-9]+).[A-Za-z0-9]+$/;
        var message1='这字段不能留空';
        var message2='两次邮箱不一样';
        var message3='请输入有效的电子邮箱地址';
        if(!url_has('/zh-CN')){
            message1='Can\'t be empty';
            message2='The two mailboxes are different';
            message3='Please enter a valid email address';
        }
        if(email == '') {
            $(this).parent().removeClass('formsuccess');
            $(this).parent().addClass('formerror');
            $(this).siblings('.input-row-error').removeClass('hidden');
            $(this).siblings('.input-row-error').children('span').text(message1);
        } else if(reg.test(email)) {
            $(this).parent().removeClass('formerror');
            $(this).parent().addClass('formsuccess');
            $(this).siblings('.input-row-error').addClass('hidden');
            if($('.qraddressa').val()!=$('.qraddressb').val()){
                if($(this).hasClass('qraddressb')){
                    $(this).parent().removeClass('formsuccess');
                    $(this).parent().addClass('formerror');
                    $(this).siblings('.input-row-error').removeClass('hidden');
                    $(this).siblings('.input-row-error').children('span').text(message2);
                }

            }


        } else {
            //$(this).parent().removeClass('formsuccess');
            //$(this).parent().addClass('formerror');
            //$(this).siblings('.input-row-error').removeClass('hidden');
            //$(this).siblings('.input-row-error').children('span').text(message3);

        }

    });
    //注册验证
    $('#register_address_two,.register_address').blur(function() {
        var email = $(this).val();
        var reg =  /^\w+((.\w+)|(-\w+))(\w{3})@[A-Za-z0-9]+((.|-)[A-Za-z0-9]+).[A-Za-z0-9]+$/;
        var message1='这字段不能留空';
        var message2='两次邮箱不一样';
        var message3='请输入有效的电子邮箱地址';
        if(!url_has('/zh-CN')){
            message1='Can\'t be empty';
            message2='The two mailboxes are different';
            message3='Please enter a valid email address';
        }
        if(email == '') {
            $(this).parent().removeClass('formsuccess');
            $(this).parent().addClass('formerror');
            $(this).siblings('.input-row-error').removeClass('hidden');
            $(this).siblings('.input-row-error').children('span').text(message1);
        } else if(reg.test(email)) {
            $(this).parent().removeClass('formerror');
            $(this).parent().addClass('formsuccess');
            $(this).siblings('.input-row-error').addClass('hidden');
            if($('.qraddressa').val()!=$('.qraddressb').val()){
                if($(this).hasClass('qraddressb')){
                    $(this).parent().removeClass('formsuccess');
                    $(this).parent().addClass('formerror');
                    $(this).siblings('.input-row-error').removeClass('hidden');
                    $(this).siblings('.input-row-error').children('span').text(message2);
                }

            }


        } else {
            $(this).parent().removeClass('formsuccess');
            $(this).parent().addClass('formerror');
            $(this).siblings('.input-row-error').removeClass('hidden');
            $(this).siblings('.input-row-error').children('span').text(message3);

        }

    });
//密码验证
    $('#register_password,.register_password').blur(function() { //密码验证

        var email = $(this).val();
        var message1='这字段不能留空';
        var message2='两次密码不一样';
        var message3='密码只能包含至少6个字符,至多40个字符';
        if(!url_has('/zh-CN')){
            message1='Can\'t be empty';
            message2='The two passwords are different';
            message3='Passwords can only contain at least 6 characters and up to 40 characters';
        }
        if(email == '') {
            $(this).parent().removeClass('formsuccess');
            $(this).parent().addClass('formerror');
            $(this).siblings('.input-row-error').removeClass('hidden');
            $(this).siblings('.input-row-error').children('span').text(message1);
        } else if(email.length >= 6 && email.length <= 40) {
            $(this).parent().removeClass('formerror');
            $(this).parent().addClass('formsuccess');
            $(this).siblings('.input-row-error').addClass('hidden');
            if($('.qrpassworda').val()!=$('.qrpasswordb').val()){
                if($(this).hasClass('qrpasswordb')){
                    $(this).parent().removeClass('formsuccess');
                    $(this).parent().addClass('formerror');
                    $(this).siblings('.input-row-error').removeClass('hidden');
                    $(this).siblings('.input-row-error').children('span').text(message2);
                }

            }

        } else {
            $(this).parent().removeClass('formsuccess');
            $(this).parent().addClass('formerror');

            $(this).siblings('.input-row-error').removeClass('hidden');
            $(this).siblings('.input-row-error').children('span').text(message3);

        }

    }); // func
    //验证end
    /**************************注册登录页end***********/
    /***********************index 首页 end ********/
    //阻止冒泡事件
    maopao('.home_header_bottom .menu');
    /***********************index 首页 end ********/
    /*******************product_list 列表页  start*I************/
    //选择价格 排序
    function fenleibox(elem){
        $(elem).click(function(e) {
            e.stopPropagation();
            if(!$(this).next('.fenleiprice').hasClass('hidden')) {
                $(this).next('.fenleiprice').addClass('hidden');
                maopaoclosexia();
            } else {
                maopaoclose();
                maopaoclosexia();
                $(this).next('.fenleiprice').removeClass('hidden');
                maopaocloseshang($(this).children('.glyxia'));

            }
            $(this).next('.fenleiprice').click(function(e) {
                e.stopPropagation();
            });
        });
    }
    fenleibox('#product_list .content__inner  .maijiabox .fenleibox .wenbenbox');
    fenleibox('#login_guanli .fenleibox .wenbenbox');
    fenleibox('#product_list .product-search-bar-wrap  .container .fenleibox .wenbenbox');
    fenleibox('.content__inner .row .fenleibox .wenbenbox');
    //选择价格 end
    //卖家认证
    $('.yanzhendui').hover(function() {
        $(this).nextAll('.boxrenzhen').removeClass('hidden');
    }, function() {
        $(this).nextAll('.boxrenzhen').addClass('hidden');
    });

    function canvasdengji(xx, level) {
        //1:获取画笔
        if(level == '' || level == undefined) {
            level = 153; //假设最高等级180
        }

        var deg = 2 * level;
        if($id(xx))
            var ctx = $id(xx).getContext("2d");
        else return false;
        //2:绘制灰色底框
        ctx.beginPath();
        ctx.arc(30, 30, 27, 0 * Math.PI / 180, 360 * Math.PI / 180);
        ctx.lineWidth = 3;
        ctx.strokeStyle = "#EFEFF4";
        ctx.stroke();
        //3:绘制绿色前进状态的进度条 15:44-15:46
        var start = -90; //开始角度
        var end = deg - 90; //结束角度
        ctx.beginPath(); //此练习无需清除画布
        ctx.arc(30, 30, 27, start * Math.PI / 180, end * Math.PI / 180);
        ctx.strokeStyle = "#1693DA";
        ctx.stroke();
    }
    canvasdengji('canvasdengji'); //等级
    //title自定义
    nexthiddenshow(`#product_list .products__content .liebiao .libox .boxleft .boxbottom .imgboxdengji,
		#product_list .content__inner  .products__content .liebiao .libox .boxleft .boxbottom .imgboxtime,
		#product_list .content__inner  .products__content .liebiao .libox .boxleft .boxbottom .imgcanvas,
		#product_list .content__inner  .products__content .liebiao .libox .boxleft .boxtop .yanzhen 
		`);
    //product input  输入数量 计算总价 最大值，购买量
    $('body').on('keyup','.product_price',function() {
        if($(this).hasClass('disable_price')){
            return false;
        }
        let minval = parseInt($(this).attr('data'));
        let maxval = parseInt($(this).parents('.timebox').find('.gold').data('num'));
        let danjia = parseFloat($(this).parents('.timebox').parent().find('.danjia').eq(0).text()).toFixed(8);
        let currtext = $(this).attr('data-currency');
        let multiple = parseInt($(this).attr('data-multiple'));
        let numval = parseInt($(this).val());
        $(this).parents('.timebox').next().find('.price').text(accMul($(this).val(), danjia).toFixed(2)+' '+currtext);
        if ($('.pre-coupon-price').length > 0) {
            old_danjia = parseFloat($('.pre-coupon-price').data('price'));
            $(this).parents('.timebox').next().find('.oldprice').text(accMul($(this).val(), old_danjia).toFixed(2));
        }
        if($(this).val() == '' || $(this).val == undefined) {
            $(this).next().removeClass('hidden');
            $(this).next().text('Invalid input');
            if(url_has('/zh-CN')){
                $(this).next().text('无效的输入');
            }
            $(this).addClass('borderred');
            $(this).parents('.timebox').next().find('.price').text('0.00');
        } else {
            if($(this).val() > maxval) {
                $(this).next().removeClass('hidden');
                $(this).next().text('Maximum purchase is ' + maxval);
                if(url_has('/zh-CN')){
                    $(this).next().text('最大购买 ' + maxval);
                }
                $(this).addClass('borderred');
                $(this).parents('.timebox').next().find('.price').text('0.00');
            } else if($(this).val() < minval) {
                $(this).next().removeClass('hidden');
                $(this).next().text('Minimum purchase is ' + minval);
                if(url_has('/zh-CN')){
                    $(this).next().text('最低购买 ' + minval);
                }
                $(this).addClass('borderred');
                $(this).parents('.timebox').next().find('.price').text('0.00');
            } else {
                $(this).next().addClass('hidden');

                $(this).removeClass('borderred');

                let buy_button = $(this).parents('.timebox').next('div').find('.show-cart-icon');
                if (buy_button.data('href')!= undefined && buy_button.data('href').indexOf('?') > -1) {
                    buy_url = buy_button.data('href')+'&buy_num='+$(this).val();
                } else {
                    buy_url = buy_button.data('href')+'?buy_num='+$(this).val();
                }
                buy_button.attr('href',buy_url);
            }
        }
    });

    //product_list 更多信息
    (()=>{
        $('body').on('click','#product_list .content__inner  .products__content .liebiao .libox .boxright .boxmiddle .genginfo',function(e) {
            e.stopPropagation();
            if(!$(this).parents('.boxmiddle').nextAll('.product_infobox').hasClass('xianshi')) {
                $(this).parents('.boxmiddle').nextAll('.product_infobox').addClass('xianshi');
                $(this).parents('.liebiao .libox ').siblings().find('.product_infobox').removeClass('xianshi');
                maopaoclosexia();
                maopaocloseshang($(this).children('.glyxia'));

            } else {
                $(this).parents('.boxmiddle').nextAll('.product_infobox').removeClass('xianshi');
                maopaoclosexia();
            }
        });
    })();
    /*******************product_list 列表页  end*I************/
    /*******************************个人中心 start****************/
    //点击修改内容
    $('.tanboxall').click(function(e) {
        e.stopPropagation();
        maopaoclose();
        var name = $(this).children('.wenbenp').text();
        var name2 = $(this).children('.wenbens').text();
        $(this).find('.baocuo').text('');
        var input1, inputqingchu, select_a;
        var alltankuang = $(this).children('.alltankuang');
        let allnumber=$('#login_guanli .sellmain .signcheckbox').length;
        let the_selected=$('#login_guanli .sellmain .signcheckbox:checked').length;
        alltankuang.find(' .all_selected_text').text(allnumber);
        alltankuang.find(' .the_selected_text').text(the_selected);
        if(alltankuang.find('.inputbox .inputtext')) { //如果存在input
            input1 = alltankuang.find('.inputbox .inputtext');
            inputqingchu = alltankuang.find('.inputbox .closexx');
            input1.val($.trim(name));
            inputqingchu.click(function() {
                input1.val('');
                input1.focus();
            });
        }
        var result = alltankuang.find('.buttonbox .quxiao');
        var resultTwo = alltankuang.find('.page-manlist-close-btn');
        var queding = alltankuang.find('.buttonbox .queding');
        alltankuang.fadeToggle(500);
        result.click(function() {
            alltankuang.fadeOut(500);
        });
        resultTwo.click(function() {
            alltankuang.fadeOut(500);
        });
        queding.click(() => {
            if(alltankuang.find('.inputbox .inputtext').length == 1) { //如果存在input

                $(this).children('.wenbenp').text($.trim(input1.val()));

            }
            if(alltankuang.find('.inputbox .selectall').length == 1) { //如果存在select

                $(this).children('.wenbens').text($.trim(select_a.children('option:selected').text()));

            }
            alltankuang.fadeOut(500);
        });
        alltankuang.click(function(f) {
            f.stopPropagation();

        });

    });
//个人中心的选项卡 点击
    function person_xuanxiangfun() { //选项卡函数
        $('#person_index .xuanxiangka .libox').each(function(index) {
            $(this).removeClass('active');
            if(sessionStorage['person_xuanxiang'] == 1) {
                $('#person_index .person_xxcontent>div').addClass('hidden');
                $('#person_index .person_xxcontent .person_ziliao').removeClass('hidden');
                $('#person_index .xuanxiangka .libox.geren').addClass('active');

            } else if(sessionStorage['person_xuanxiang'] == 2) {
                $('#person_index .person_xxcontent>div').addClass('hidden');

                $('#person_index .person_xxcontent .person_fensi').removeClass('hidden');
                $('#person_index .xuanxiangka .libox.fensi').addClass('active');

            } else if(sessionStorage['person_xuanxiang'] == 3) {
                $('#person_index .person_xxcontent>div').addClass('hidden');

                $('#person_index .person_xxcontent .person_sell').removeClass('hidden');
                $('#person_index .xuanxiangka .libox.selldian').addClass('active');

            } else {
                $('#person_index .person_xxcontent>div').addClass('hidden');

                // $('#person_index .person_xxcontent .person_guanzhu').removeClass('hidden');
                // $('#person_index .xuanxiangka .libox.guanzu').addClass('active');
                $('#person_index .person_xxcontent .person_ziliao').removeClass('hidden');
                $('#person_index .xuanxiangka .libox.geren').addClass('active');
            }
        });

    }
    person_xuanxiangfun();
    ////个人中心的选项卡 默认展示
    $('#person_index .xuanxiangka .libox').each(function() { //个人中心选项卡
        $(this).click(function(e) {
            e.stopPropagation();
            if($(this).hasClass('geren')) {
                sessionStorage['person_xuanxiang'] = 1;
            } else if($(this).hasClass('fensi')) {
                sessionStorage['person_xuanxiang'] = 2;
            } else if($(this).hasClass('selldian')) {
                sessionStorage['person_xuanxiang'] = 3;
            } else {
                sessionStorage['person_xuanxiang'] = 4;
            }
            person_xuanxiangfun();
        });
    });

    /*******************************个人中心 end****************/
    /****************** login_sell 注册卖家 start******************************************/

    //卖家导航与主业导航的显示
    if(url_has('/sell/')||url_has('/userComment')|| url_has('/userStorage/')||url_has('/userCenter')||url_has('/userCoupon')||url_has('/My/index')||url_has('/buyOrder')||url_has('/loans')||url_has('/payMent/p_index')||url_has('/payment/')||url_has('/payMent/account')||url_has('/payMent/index')||url_has('/DisputeCenter')||url_has('/disputeCenter')||url_has('/UserCenter')||url_has('/sellOrder/')||url_has('/user/')||url_has('/Distribution/')){
        $('.z2u .home .home_nav').css('display','none');
        $('.z2u  .home_header_bottom .classification').removeClass('hidden-md hidden-lg');
        $('.z2u  .home_header_bottom .classification').css('display','block');
        if(url_has('/sell/discount')){
            $('.z2u .home .home_nav').css('display','block');
            $('.z2u .home .home_nav').addClass('hidden-xs hidden-sm');
            $('.z2u  .home_header_bottom .classification').addClass('hidden-md hidden-lg');
        }
    }
    else{
        $('.z2u .home .home_nav').css('display','block');
        $('.z2u .home .home_nav').addClass('hidden-xs hidden-sm');
        $('.z2u  .home_header_bottom .classification').css('display','block');

    }
    //卖家导航的默认显示
    $('.login_sell .sellnav .navbox .libox').each(function(e) {

        let url = window.location.href;
        let url_length=url.length;

        let liebiaourl = url.indexOf('sell');

        let guanlilie = url.indexOf('sell/manage');
        let yanzhen1url1 = url.indexOf('sell/sellIdcardVerify');
        let yanzhen1url2 = url.indexOf('sell/sellApply');
        let yanzhen1url3 = url.indexOf('sell/sellMobileVerify');
        let yanzhen1url4=url.indexOf('sell/index');
        let guanliliedeail = url.indexOf('login_gldeail/index');
        let paydiandan = url.indexOf('buyOrder');
        let dengdai_pay=url.indexOf('dengdai_pay/index');
        let xiaoshouidiandan = url.indexOf('sellOrder');
        let historical_record=url.indexOf('My/index');
        let news=url.indexOf('/news');
        let detail=url.indexOf('/detail');
        let loans=url.indexOf('/loans');
        let loans2=url.indexOf('/payMent/p_index');
        let loans3=url.indexOf('/payMent/account');
        let loans4=url.indexOf('/payMent/index');
        $(this).removeClass('active');
        //判断页面
        if(liebiaourl != -1&&liebiaourl==url_length-4) {

            if($(this).hasClass('cr')) {

                $(this).addClass('active');
            }
        }
        else if(guanlilie != -1 || guanliliedeail != -1){
            if($(this).hasClass('gl')){
                $(this).addClass('active');
            }
        }
        else if(yanzhen1url1 != -1 || yanzhen1url2 != -1 || yanzhen1url3 != -1||yanzhen1url4!=-1) {
            if($(this).hasClass('yanzhenp')) {

                $(this).addClass('active')
            }
        } else if(paydiandan != -1||dengdai_pay!=-1) {
            if($(this).hasClass('goumaidiandan')) {

                $(this).addClass('active')
            }

        } else if(xiaoshouidiandan != -1) {

            if($(this).hasClass('xiaoshouidiandan')) {

                $(this).addClass('active')
            }
        }
        else if(historical_record!=-1){
            if($(this).hasClass('historical_record')) {

                $(this).addClass('active')
            }
        }
        else if(loans!=-1||loans2!=-1||loans3!=-1||loans4!=-1){
            if($(this).hasClass('loans')) {

                $(this).addClass('active')
            }
        }
        else if(news!=-1||detail!=1){
            if($(this).hasClass('news')) {

                $(this).addClass('active')
            }
        }



    });
    //安全中心的导航
    $('.person_account .midsection #mySidenav #accordion .am-panel').each(function(e) {
        let url = window.location.href;
        let user_center_index=url.indexOf('userCenter/index');
        let user_center_account=url.indexOf('userCenter/account');
        $(this).removeClass('active');
        //判断页面
        if(user_center_index != -1 ) {

            if($(this).hasClass('user_center_index')) {

                $(this).addClass('active');
                //儿子的子元素获取active

            }
        }
        else if(user_center_account != -1 ){
            if($(this).hasClass('user_center_account')) {

                $(this).addClass('active');
                //儿子的子元素获取active

            }
        }

    });
    //卖家添加联系方式
    $('#login_sell .registermain .libox label .inputbox .select').change(function() { //添加联系方式 2020.8.4 #login_sell last del .sellmain .registerbox
        let name = '';
        var html_other = '';
        var html = `<div class="lianxiafangsi border-none-in">
						 	 <div  class="lxfs-wrap"><div class="imgbox">`;

        if($(this).val() == 'QQ') {
            html += `<div class='img google qq'></div>`;
            name = 'qq';
            $('#getcontent').find('.special-info').html('QQ : 2881266847');
            html_other = $('#getcontent').html();
        } else if($(this).val() == 'Skype') {
            html += `<div class='img google Skype'></div>`;
            name = 'skype';
            $('#getcontent').find('.special-info').html('Skype : live:.cid.4912ebf5fc781700');
            $('#getcontent').find('input').attr('name','checked[skype]');
            html_other = $('#getcontent').html();
        } else if($(this).val() == 'Whatsapp') {
            html += `<div class='img google Whatsapp'></div>`;
            name = 'whatsapp';
            $('#getcontent').find('.special-info').html('whatsapp : +86 13389653886');
            $('#getcontent').find('input').attr('name','checked[whatsapp]');
            html_other = $('#getcontent').html();
        }
        html += `</div><input type="text" name="${name}"/>
						 	<span class="closexx">x</span></div>`;
        html += html_other;
        html += `</div>`;
        //查找有误相同的，有就删除
        let name1 = $(this).parents('.libox').find('.lianxiafangsi input');

        name1.each(function(e) {
            if($(this).attr('name') == name) {
                $(this).parents('.lianxiafangsi').remove();
            }
        });
        if($(this).val()!=0)
            $(this).parents('.libox').append(html);
    });
    $('body').on('click', '.lianxiafangsi .closexx', function() {

        $(this).parents('.lianxiafangsi').remove();
    })
    //卖家验证码自动跳下一个

    $('.inputboxyzhen input').bind('input propertychange', function(e) {
    //$('.inputboxyzhen input').keyup(function(e) {

        if($(this).val().length > 1 && !isNaN($(this).val())) {
            var b = $.trim($(this).val());

            var c = b.split('');
            $(this).val(c[0]);
            if(panture(c[0])) {
                $(this).next().focus();
            }
            if(panture(c[1])) {
                $(this).next().next().focus();
            }
            if(panture(c[2])) {
                $(this).next().next().next().focus();
            }
            if(panture(c[3])) {
                $(this).next().next().next().next().focus();
            }
            if(panture(c[4])) {
                $(this).next().next().next().next().next().focus();
            }
            $(this).next().val(c[1]);
            $(this).next().next().val(c[2]);
            $(this).next().next().next().val(c[3]);
            $(this).next().next().next().next().val(c[4]);
            $(this).next().next().next().next().next().val(c[5]);


        }

        if(e.keyCode == 8) {
            if($(this).index() > 0) {
                $(this).prev().focus();
            }
        } //key
        else {
            if(isNaN($(this).val()) || $(this).val == '') {
                $(this).val('');
            } else {
                if($(this).index() < 5 && (e.keyCode >= 48 && e.keyCode <= 57 || e.keycode >= 96 && e.keyCode <= 105)) {
                    $(this).next().focus();
                }
            }

        }

    });
    //发送验证码
    $('#security_info .fasong button').click(function() {
        $.ajax({
            type: 'get',
            url: "/Platform/Sell/sendSms",
            dataType: 'json',
            success: (res)=> {
                if(res.code == 0) {
                    let html = '';
                    html += ` <div class="baocuodiv margin_10">
                           	   <span class="text-success">${res.msg}</span> 
                           </div>`;
                    if($(this).parents('.yzm_form').find('.baocuodiv')) {
                        $(this).parents('.yzm_form').find('.baocuodiv').remove();
                    }
                    $(this).parents('.yzm_form').find('.yzm').parent().append(html);
                } else {
                    let html = '';
                    html += ` <div class="baocuodiv margin_10">
                           	   <span class="text-success">${res.msg}</span> 
                           </div>`;
                    if($(this).parents('.yzm_form').find('.baocuodiv')) {
                        $(this).parents('.yzm_form').find('.baocuodiv').remove();
                    }
                    $(this).parents('.yzm_form').find('.yzm').parent().append(html);
                }
            }

        });
        $(this).attr('disabled','disabled');
        var n = 30;
        $(this).text('重新发送30s后');
        var ttime = setInterval(() => {
            n--;
            $(this).text('重新发送' + n + 's后');
            if(n <= 0) {
                $(this).text('获取验证码');
                clearInterval(ttime);
                $(this).prop('disabled','');
            }
        }, 1000);
    });

    //验证码的form 提交
    $('#yzm_form,.yzm_form').submit(function(e) {
        var b = '';
        $(this).find('.textcon').each(function() {
            b += $(this).val();
        });

        $(this).find('.yzm').val(b);
        let yanzhengma=$(this).find('.yzm').val();

        //		var htmlobj = $.ajax({
        //			url: "/jquery/test1.txt",
        //			async: false
        //		});
        //		if($(this).find('.yzm').val() != htmlobj.responseText) {
        //			return false; //false:阻止提交表单
        //		}
        let html = '';
        if($(this).find('.yzm').val() == "123456") {
            //		    	$(this).focus;
            html += ` <div class="baocuodiv margin_10">
                           	   <span class="font_color_red">验证码错误:</span> ${yanzhengma}
                           </div>`;
            if($(this).find('.baocuodiv')) {
                $(this).find('.baocuodiv').remove();
            }
            $(this).find('.yzm').parent().append(html);

            return false; //false:阻止提交表单
        } else {
            html = '';
        }

    });

    $('.save_email_submit').click(function () {
        var form = $(this).parents('form');
        var b = '';
        form.find('.textcon').each(function() {
            b += $(this).val();
        });
        form.find('.yzm').val(b);
        if (form.find('.yzm')) {
            form.submit();
        }
    });

    //邮箱验证码提交

    /****************** login_sell 注册卖家 start******************************************/
    /******************product_search 搜索页面 start******************************/
    (() => {
        let table_td_a = $('.product_search  .searchbox .searchtankuang table td a');
        let search_button = $('.product_search  .searchbox button');
        let keywords=$('.product_search  .searchbox #keywords_search');
        let searchtankuang = $('.product_search  .searchbox .searchtankuang');
        let remen_ul = $('.product_search  .remen_ul');
        let remen_wenben = $('.product_search .remen_ul .remen_li .wenbenbox .h3_title');
        let youxinav = $('.product_search .product_search_xuanxiang  .ulbox .libox'); //游戏导航
        let arr = [];
        let quarr = [];
        remen_ul.children('.remen_li').each(function(index) {
            let textbox = $(this).find('.h3_title').text();
            arr[arr.length] = Mtils.utils.makePy(textbox, true).substring(0, 1);
            function uniq(array) {
                for(var i = 0; i < array.length; i++) {
                    if(quarr.indexOf(array[i]) == -1) {
                        quarr.push(array[i]);
                    }
                }
                return quarr;
            }
            uniq(arr);
        });

        youxinav.click(function() {
            $(this).siblings().removeClass('active');
            $(this).addClass('active');
        });
        search_button.click(function(e) { //筛选按钮
            e.stopPropagation();
            if(!searchtankuang.hasClass('hidden')) {
                searchtankuang.addClass('hidden');
            } else {
                searchtankuang.removeClass('hidden');
            }
            searchtankuang.click(function(e) { //阻止冒泡事件
                e.stopPropagation();
            });
        });

        keywords.keyup(function(){
            let val=$(this).val().toLowerCase();
            remen_ul.children('.remen_li').each(function() {
                let textbox = $(this).find('.h3_title').text().toLowerCase();
                let alias=$(this).find('.h3_title').attr('data').toLowerCase();
                let jc_price=$(this).find('.jc_price').text().toLowerCase();
                if(textbox.indexOf(val)!=-1||alias.indexOf(val)!=-1){
                    $(this).removeClass('hidden');
                } else {
                    $(this).addClass('hidden');
                }
            });

            //feedback
            var gameListNum = $('#jianchan .remen_ul').find('.remen_li').length;
            //console.log(gameListNum)
            var hidegameListNum = $('#jianchan .remen_ul').find('.hidden').length;
            //console.log(hidegameListNum)
            if(gameListNum == hidegameListNum){
                $('.feedback-tips-alert').removeClass('hidden');
            }else {
                $('.feedback-tips-alert').addClass('hidden');
            }
        });
        remen_ul.children('.remen_li').each(function() {
            $(this).removeClass('hidden');
        });
    })();

    /******************product_search 搜索页面 end******************************/
    /********************个人中心 user_center start*****************************/
    //安全中心导航的点击
    function produt_account() {
        let nav = $('.user_center .midsection #mySidenav #accordion .am-panel-hd');
        nav.click(function(e) {
            e.stopPropagation();
            if($(this).children().children().hasClass('glyphicon-menu-down')) {
                $(this).children().children().removeClass();
                $(this).children().children().addClass('glyxiab glyphicon glyphicon-menu-up');
                $(this).next().css('display', 'block');
                $(this).css('color', '#fff');
            } else {
                $(this).children().children().removeClass();
                $(this).children().children().addClass('glyxiab glyphicon glyphicon-menu-down');
                $(this).next().css('display', 'none');
                $(this).css('color', '#6ec8c7');
            }

        });
        //安全中心添加联系方式
        $('.account_main .card .form .form-normal .libox label .inputbox .select').change(function() { //添加联系方式
            var html = `<div class="lianxiafangsi">
						 	 <div class="imgbox">`;
            let name = '';
            if($(this).val() == 'QQ') {
                html += `<div class='img google qq'></div>`;
                name = 'qq';
            } else if($(this).val() == 'Skype') {
                html += `<div class='img google Skype'></div>`;
                name = 'skype';
            } else if($(this).val() == 'Whatsapp') {
                html += `<div class='img google Whatsapp'></div>`;
                name = 'whatsapp';
            }
            html += `</div>
						 	<input type="text" name="${name}"/>
						 	<span class="closexx">x</span>
	    				</div>`;
            //查找有误相同的，有就删除
            let name1 = $(this).parents('.libox').find('.lianxiafangsi input');
            console.log(name);
            name1.each(function(e) {
                if($(this).attr('name') == name) {
                    $(this).parents('.lianxiafangsi').remove();
                }
            });
            if($(this).val()!=0)
                $(this).parents('.libox').append(html);
        });
    }
    produt_account();
    /********************个人中心 user_center end*****************************/
    /**********************************申请游戏 start**********************/
    $('body').on('submit', '#login_update #sell_apply .sell_apply_form', function(e) {
        if($(this).find('.congzhiinput').prop('checked')) {

        } else {
            e.preventDefault();
            var html = '';
            html += `
      	           <div class='jianshanbaocuo flex_start'>
      	              <span class='glyphicon glyphicon-remove-circle gantai font_color_red'></span>
      	             <span class='font_color_red wenbencuo'>请勾选</span>
      	           </div>
      	        `;
            $(this).find('.registermain .wenben').append(html);
        }
    });
    /**********************************申请游戏 end**********************/
    /***************************卖家注册start*********************/
    //同意勾选，既可以提交
    (() => {
        let checkbox1 = $('#login_sell .registerbox .register_footer input[type=checkbox]');
        let button1 = $('#login_sell  .registerbox .register_footer button[type=button]');

        checkbox1.click(function() {
            if($(this).prop('checked')) {
                button1.removeAttr('disabled');
            } else {
                button1.attr('disabled', 'disabled');
            }
        });
        checkbox1.each(function() {
            if($(this).prop('checked')) {
                button1.removeAttr('disabled');
            } else {
                button1.attr('disabled', 'disabled');
            }
        });
    })();
    /***************************卖家注册end*********************/
    /************购买订单 start ******/
    //筛选
    (()=>{
        let select1=$('#pay_diandan .sellmain .paydan .headerpay .headerright .select1 .wenbenan');
        select1.click(function(e){
            $(document).click(()=>{
                $(this).next().addClass('hidden');
                $(this).find('[data="glyxia"]').removeClass('hidden');
                $(this).find('[data="glyshang"]').addClass('hidden');
            });
            e.stopPropagation();
            if($(this).next().hasClass('hidden')){
                $(this).next().removeClass('hidden');
                $(this).find('[data="glyxia"]').addClass('hidden');
                $(this).find('[data="glyshang"]').removeClass('hidden');

            }
            else{
                $(this).next().addClass('hidden');
                $(this).find('[data="glyxia"]').removeClass('hidden');
                $(this).find('[data="glyshang"]').addClass('hidden');

            }

        });
    })();
    /************购买订单  end ******/
    /******************** 安全信息 start****************/
    //展开安全信息
    (()=>{
        let open=$('#security_info .card .text_buttonbox .openbuton');
        open.click(function(e){
            let nextelem=$(this).parents('.text_buttonbox').next();
            let sibulingelem=$(this).parents('.card').siblings().find('.form_hidden');
            let sibulingopen=$(this).parents('.card').siblings().find('.text_buttonbox .openbuton');
            if(nextelem.hasClass('hidden')){
                nextelem.removeClass('hidden');
                sibulingelem.addClass('hidden');
                $(this).text('关闭');
                sibulingopen.text('编辑');
                if(!url_has('zh-CN')){
                    $(this).text('CLOSE');
                    sibulingopen.text('Edit');
                }
            }
            else{
                nextelem.addClass('hidden');
                $(this).text('编辑');
                if(!url_has('zh-CN')){
                    $(this).text('Edit');
                }
            }

        });
    })();
    //密码可见
    let input_eye=$('.register_index .midsection-small .form .form-group .input_eye');
    input_eye.click(function(e){
        if($(this).parent().find('input[type="password"]').length>0){
            $(this).parent().find('input[type="password"]').attr('type','text');
            $(this).children('.glyphicon-eye-close').removeClass('glyphicon-eye-close')
                .addClass('glyphicon-eye-open');
        }
        else{
            $(this).parent().find('input[type="text"]').attr('type','password');
            $(this).children('.glyphicon-eye-open').removeClass('glyphicon-eye-open')
                .addClass('glyphicon-eye-close');
        }
    });

});
//手机滑动

function phoneslide(elem){
    let startX=0,moveEndX=0,X=0,leavenum=0;
    elem.on("touchstart", function(e) {
        startX = e.originalEvent.changedTouches[0].pageX;

    });
    elem.on("touchend", function(e) {

        var moveEndX = e.originalEvent.changedTouches[0].pageX,
            X = moveEndX - startX;
        let lengthnum=$(this).children().length-1;
        //左滑
        if ( X > 0 ) {

            if(leavenum<0){
                leavenum+=130;
                $(this).css('left',leavenum+'px');
            }
        }
        //右滑
        else if ( X < 0 ) {
            if(-lengthnum*130<leavenum){
                leavenum-=130;
                $(this).css('left',leavenum+'px');
            }
        }

    });
}

$(function(){

    phoneslide($('#login_guanli .sellmain .search_sort .ulbox'));
    phoneslide($('.product_search .product_search_xuanxiang .container_box .ulbox'));
    phoneslide($('#product_list #equipment .equipment_box .ulposition .ulbox'));
    let language=$('.home_header .language_currency .select_con.language');

    language.click(function(e){
        e.stopPropagation();
        let hiddenbox=$(this).children('.languagebox');
        close_elem(hiddenbox);
        if(hiddenbox.hasClass('hidden')){
            hiddenbox.removeClass('hidden');
        }
        else{
            hiddenbox.addClass('hidden');
        }
    });

});

$(function(){
    //product_list
    // $('#product_list .fenleibox .fenleiprice .libox a').click(function (e) {
    //     e.preventDefault();
    //     let url=location.href;
    //     let sortr='';
    //     urlpanduan(url,sortr,'sort',$(this).attr('data'));
    // });
    //工单 查看更多
    $('#dengdai_pay  .message_header .text_symbol').click(function(e){
        let message_libox=$('#dengdai_pay  .message_contentbox .message_libox');
        let children_span=$(this).children();
        message_libox.each(function(e){
            if($(this).hasClass('judge_more')){
                $(this).removeClass('judge_more');
                children_span.removeClass('glyphicon-plus')
                    .addClass('glyphicon-minus');
                $('#dengdai_pay .message_view_more').addClass('hidden');
            }
            else{
                $(this).addClass('judge_more');
                children_span.removeClass('glyphicon-minus')
                    .addClass('glyphicon-plus');
                $('#dengdai_pay .message_view_more').removeClass('hidden');
            }
        });

        // $(this).parents('.message_header').siblings('.message_content').find('.message_libox').css('display','flex');
    });
    $('#dengdai_pay .message_view_more span').click(function(e){
        $('#dengdai_pay  .message_header .text_symbol').click();
    });
//工单信息
    $('#dengdai_pay .sellmain .paydan .deailtable .deailxinxi .game_message_header').click(function(e){
        if($(this).next('.game_message_box').css('display')=='none'){
            $(this).next('.game_message_box').slideDown(1000);
            $(this).find('.glyphicon.glyphicon-plus').removeClass('glyphicon-plus')
                .addClass('glyphicon-minus');
        }
        else{
            $(this).next('.game_message_box').slideUp(1000);
            $(this).find('.glyphicon.glyphicon-minus').removeClass('glyphicon-minus')
                .addClass('glyphicon-plus');
        }
    });
});
//工单输入的显示，获取焦点
function contact_sell(){
    $('#dengdai_pay .contact_sendbox').removeClass('hidden');
    $('#contact_send').focus();
}
function inputreg(elem){
    var $text1= elem.get(0);

    $text1.validity.valueMissing//判断表单内容是否为空
        ?$text1.setCustomValidity('The value can\'t be empty.')//设置错误提示
        : $text1.setCustomValidity('');
}
//问好满足 悬停，点击
$("#product_jiezhang .wenhao,#dengdai_pay .wenhao").popover({ trigger: "manual" , html: true, animation:false})
    .on("mouseenter", function () {
        var _this = this;
        $(this).popover("show");
        $(".popover").on("mouseleave", function () {
            $(_this).popover('hide');
        });
    }).on("mouseleave", function () {
    var _this = this;
    setTimeout(function () {
        if (!$(".popover:hover").length) {
            $(_this).popover("hide");
        }
    }, 300);
});
//创建列表 输入
$(function(){
    $('body').on('keyup','#login_createli .jiage',function (e) {
        let text_b=$(this).val();
        let shuliang=$('#login_createli .shuliang').val();
        if(panture(text_b)){
            $('.price_message').removeClass('hidden');
        }else{
            //$('.price_message').addClass('hidden');
        }
        text_b = text_b ? text_b : '?';
        $('.price_message .number').text(text_b);
        if(panture(shuliang)){
            $('#login_createli .shuliang').keyup();
        }
    });
    $('body').on('keyup','#login_createli .shuliang',function (e) {
        let text_b=$(this).val();
        if(panture(text_b)){
            $('.total_price').removeClass('hidden');
        }
        else{
            $('.total_price').addClass('hidden');
        }
        $('.total_price .number').text(text_b);
        $('.total_price .total_number').text((text_b*$('.price_message .number').text()).toFixed(2));
    });
    //checkout   删除图片
    $('#product_jiezhang .main .imgbox_upload .glyphicon').click(function(){
        $('#product_jiezhang .main .imgbox_upload').addClass('hidden');
        $('#product_jiezhang #imagename,#product_jiezhang #buy_create_order_after_img').val('');
        $('#product_jiezhang .imagename').removeClass('hidden');
        $(this).parents('.buy_order_img').children('input').val('');
        $(this).parents('.buy_order_img').find('.box_upload >span.hidden').removeClass('hidden');
    });
    $('#dengdai_pay .sellxinxi .buttonbox .reject').click(function(){
        $('.reject_reason').removeClass('hidden');
    });
    /****************多选 start*******************/
    $('body').on('click', '.multiple_choice .click_box', function(e) {
        //按钮点击显示下拉选项并清空search匡
        e.stopPropagation();

        if($(this).next().hasClass('hidden')) {
            $('.multiple_choice .ulbox').addClass('hidden');
            $(this).next().removeClass('hidden');
            let topleave=0;
            $(this).next().find('.ulboxzi').scrollTop(0);
            let active=$(this).next().find('.ulboxzi .active');
            if(active.length>0){
                topleave=active.position().top;
                $(this).next().find('.ulboxzi').scrollTop(topleave);
            }

        } else {
            $(this).next().addClass('hidden');
        }
        $(this).next().find('.text').val('');
        $(this).next().find('.libox').show();
    });
    $('body').on('click', '.multiple_choice .ulbox', function(e) {
        //阻止下拉框的默认点击事件
        e.stopPropagation();
    });
    $('body').on('click', '.multiple_choice .libox input', function() {
        //下拉框单个的点击
        let contentbox=$(this).parents('.multiple_choice').find('.the_content_box');
        let text1 = $(this).siblings('.text_li').text();
        let data1 = $(this).parent().attr('data');
        let contenboxli=`<div class="contentboxli" data="${data1}">
                                <span class="content_text">${text1}</span>
                                <span class="content_close">&times;</span>
                         </div>`;
        if($(this).prop('checked')==true){
            $(this).parent().addClass('active');
            $(this).parents('.multiple_choice').find('.the_default').addClass('hidden');
            contentbox.removeClass('hidden');
            contentbox.append(contenboxli);
        }
        else{
            $(this).parent().removeClass('active');
            contentbox.find(`[data='${data1}']`).remove();
        }

    });
    $('body').on('keyup', '.multiple_choice .text', function() {
        //search框的按下事件
        let val = $(this).val();

        if(val != undefined) {
            $(this).parent().next().find('.libox').hide();
            $(this).parent().next().find('.libox').each(function() {

                if(($(this).text().toUpperCase()).indexOf(val.toUpperCase()) != -1) {

                    $(this).show();
                }
            });

        }
    });
    $('body').on('click', '.multiple_choice  .content_close', function(e) {
        e.stopPropagation();
        let data1=$(this).parent().attr('data');
        $(this).parents('.multiple_choice').find('.libox').each(function(){
            if($(this).attr('data')==data1){
                $(this).removeClass('active');
                $(this).find('input').prop('checked','');
            }
        });
        $(this).parent().remove();

    });
    /****************多选 end*******************/
    $('#dengdai_pay .motaikuang.cancel_order .choose_sign label input').click(function(e){
        let price_text=$('#refund_amount');
        if($(this).hasClass('part_cancel')){
            $('#dengdai_pay .motaikuang.cancel_order .cancel_numer').removeClass('hidden').focus();
            $('#dengdai_pay .motaikuang.cancel_order .cancel_numer').keyup(function(){
                if(panture($(this).val())&&$(this).val()>0){
                    if($(this).val()>parseFloat($(this).attr('max'))){
                        $(this).val(parseFloat($(this).attr('max')));
                    }
                    let sigin_price=parseFloat(price_text.attr('data'));
                    let total=(parseFloat($(this).val())*sigin_price).toFixed(2);
                    price_text.removeClass('hidden');
                    price_text.find('.price').text(total);
                    if ($('.pre-coupon-price').length > 0) {
                        oldprice = $('.pre-coupon-price').data('price');
                        input.parents('.timebox').next().find('.oldprice').text((parseFloat($(this).val())*oldprice).toFixed(2));
                    }
                }
                else{
                    price_text.addClass('hidden');
                    price_text.find('.price').text('');
                }

            }).keypress(function(){
                return( /[\d]/.test(String.fromCharCode(event.keyCode) ) );
            });
        }
        else{
            $('#dengdai_pay .motaikuang.cancel_order .cancel_numer').addClass('hidden').val('');
            price_text.addClass('hidden');
            price_text.find('.price').text('');
        }
    });
    //手机版footer
    $('#footer .footer_box .footer_nav.phone_visible .navcon .title').click(function(e){
        if($(this).hasClass('active')){
            $(this).removeClass('active');
        }
        else{
            $(this).addClass('active')
        }
         $(this).siblings('.nav_content').slideToggle();
         $(this).parent('.navcon_nav').siblings().find('.nav_content').slideUp();
        $(this).parent('.navcon_nav').siblings().find('.title').removeClass('active');
    });
    $('#product_jiezhang .main .section .maincontent .maincontentright .buttonbox .button1').click(function(e){
         e.preventDefault();
         let pant=1;
         var loca_url = window.location.href;
        var warning_note = 'Please Input ';
        var warning_note_upload = 'Please Upload Img';
         if (loca_url.indexOf('/zh-CN/')>-1) {
             warning_note = '请输入';
             warning_note_upload = '请上传图片';
         }
         $('.need_verify:visible').each(function(){
             if(!panture($(this).val())){
                 pant=0;
                 $(this).focus();
                 data_name = $(this).attr('data');
                 data_name = data_name.replace(':', '').replace('：', '');
                 if ($(this).parent().find('.warning_note').length==0){
                     $("<span class=\"warning_note\">"+ warning_note + data_name +"</span>").appendTo($(this).parent());
                 }
                 return false;
             }
         })
        // IMG
        if (pant == 1) {
            $('.need_verify').parent('.buy_order_img:visible').each(function(){
                if(!panture($(this).find('.need_verify').val())){
                    pant=0;
                    $(this).find('.need_verify').focus();
                    if ($(this).parent().find('.warning_note').length==0){
                        $("<span class=\"warning_note\" style='font-weight: bold;font-family: auto;'>"+ warning_note_upload +"</span>").appendTo($(this).parent());
                    }
                    return false;
                }
            })
        }

        if(pant==1){
            $('#product_jiezhang  .form_buy').submit();
        }
        $('.need_verify').keyup(function(e){
             if(panture($(this).val())){
                 $(this).css('outline-color','#92B4EF');
             }
            if ($(this).parent().find('.warning_note').length!=0){
                $(this).parent().find('.warning_note').remove();
            }
        });
        $('.need_verify').change(function(e){
            if ($(this).parent().find('.warning_note').length!=0){
                $(this).parent().find('.warning_note').remove();
            }
        });
    });
});
//图片懒加载
function throttle(fn, delay, atleast) {//函数绑定在 scroll 事件上，当页面滚动时，避免函数被高频触发，
    var timeout = null,//进行去抖处理
        startTime = new Date();
    return function() {
        var curTime = new Date();
        clearTimeout(timeout);
        if(curTime - startTime >= atleast) {
            fn();
            startTime = curTime;
        }else {
            timeout = setTimeout(fn, delay);
        }
    }
}

function search_button() {
    var images = $('.loading_img');
    var len    = images.length;
    var n      = 0;      //存储图片加载到的位置，避免每次都从第一张图片开始遍历
    return function() {
        var seeHeight = document.documentElement.clientHeight;
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        for(var i = n; i < len; i++) {
            if(images[i].offsetTop < seeHeight + scrollTop) {
                if(images[i].getAttribute('loadimg') == 'loadimg') {
                    images[i].src = images[i].getAttribute('data-src');
                }
                n = n + 1;
            }
        }
    }
}
function lazyload() {
    var images = $('.loading_img');
    var len    = images.length;
    var n      = 0;      //存储图片加载到的位置，避免每次都从第一张图片开始遍历
    return function() {
        var seeHeight = document.documentElement.clientHeight;
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        for(var i = n; i < len; i++) {
            if(images[i].offsetTop < seeHeight + scrollTop) {
                if(images[i].getAttribute('loadimg') == 'loadimg') {
                    images[i].src = images[i].getAttribute('data-src');
                }
                n = n + 1;
            }
        }
    }
}
var loadImages = lazyload();
loadImages();          //初始化首页的页面图片

$(function(){
    let title=$('#game_list .game_choose .jump_to .title');
    if(title.length>0){
        let titleheight=title.get(0).offsetTop;
        let index_search='';

        window.addEventListener('scroll',function(){
            var seeHeight = document.documentElement.clientHeight;
            var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            let button_pre=$('#game_list .jump_to .popular_left');
            for(var i=0;i<button_pre.length;i++){
                if(button_pre[i].offsetTop>=scrollTop) {
                    index_search=button_pre[i].textContent.trim();
                    break;
                }
            }
            $('#game_list .game_choose .search_button').each(function(){
                if($(this).text()==index_search){
                    $(this).addClass('active');
                }
                else{
                    $(this).removeClass('active');
                }
            });
            if(titleheight <  scrollTop) {
                title.addClass('fixed');
            }
            else{
                title.removeClass('fixed');
            }
        },false);
    }

});

window.addEventListener('scroll', throttle(loadImages, 500, 1000), false);

// FAQ Search
function faqsearch() {
    var str = $('#search').val();
    if(str.length>=1){
        url = $('#searchUrl').val()+'?name='+str;
        $.get(url, function(result){
            var html='';
            $('#search_content').html('');
            if(result.length > 0){
                for(i=0;i<result.length;i++){
                    html+= '<div class="search_li"><a href="'+result[i].url+'">'+result[i].post_title+'</a></div>';
                }
            }else{
                var no_result = $('#no_result').val();
                html+='<div class="search_li"><a href="javascript:void(0);">'+no_result+'</a></div>';
            }
            $('#search_content').html(html);
            $('#search_content').show();
        });
    }else{
        $('#search_content').hide();
        $('#search_content').html('');
    }
}
